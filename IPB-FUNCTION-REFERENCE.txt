# IPB FUNCTION REFERENCE GUIDE
## Corrected Based on IPB.LSP Analysis

---

## üéØ WHAT WE DISCOVERED

By analyzing your original `IPB.LSP` file, I found the **actual** function definitions!

**Good news:** You were right about Functions 1 and 5!  
**Discovery:** Functions 2, 3, and 4 are now documented!

---

## üìã COMPLETE FUNCTION REFERENCE

### **Function 0: Standard Insert**
**What it does:** Inserts the block with no special actions  
**Use for:** Basic block insertion without any modifications  
**Example:** Simple symbols that don't need labels or special handling

---

### **Function 1: Label Point Structure**
**What it does:** Runs `(labelpointstructure)` on the block  
**Specifically:** 
- Adds point description to the top portion of the label leader block
- Uses the point elevation for the TG/RIM
- Calls a separate LISP function to handle the labeling

**Use for:** Labeled structures that need point data integration  
**Example:** Utility structures, manholes, catch basins with leader labels

**LISP Code:**
```lisp
((= function "1")
  (labelpointstructure pt1 blk1)
)
```

---

### **Function 2: Delete After Insert**
**What it does:** Inserts the block, then immediately deletes it  
**Specifically:** 
- Block is placed at the point location
- Then deleted using `entdel` command
- Leaves the point but removes the visual block

**Use for:** 
- Temporary placement markers
- Points that should exist but not show blocks
- Triggering other actions without leaving geometry

**Example:** Survey points that need processing but no visual representation

**LISP Code:**
```lisp
((= function "2")
  (entdel (vlax-vla-object->ename blk1))
)
```

---

### **Function 3: Burst After Insert**
**What it does:** Inserts the block, then "bursts" (explodes) it  
**Specifically:**
- Block is inserted
- Then exploded into individual elements
- Converts attributes to text entities
- Maintains layer, color, and linetype properties

**Use for:**
- Blocks that need to become individual editable objects
- Converting block attributes to regular text
- Breaking down complex blocks into components

**Example:** Detail markers that need to be customized per instance

**LISP Code:**
```lisp
((= function "3")
  (burst-one (vlax-vla-object->ename blk1))
)
```

---

### **Function 4: Edit Attribute + Burst**
**What it does:** Inserts block, edits first attribute with full description, then bursts  
**Specifically:**
- Block is inserted
- First attribute is set to the point's full description (`fdesc`)
- Block is then burst/exploded
- Results in text with the description

**Use for:**
- Labels that need the full point description
- Annotation blocks that become editable text
- Description-based labeling

**Example:** Generic label blocks that get customized with point descriptions

**LISP Code:**
```lisp
((= function "4")       
  (vla-put-textstring (car (vlax-invoke blk1 'getattributes)) fdesc)
  (burst-one (vlax-vla-object->ename blk1))
)
```

---

### **Function 5: Edit Attribute + Elevation + Burst**
**What it does:** Inserts block, edits first attribute with full description AND elevation, then bursts  
**Specifically:**
- Block is inserted
- First attribute is set to: `[full description] [elevation]`
- Block is then burst/exploded
- Results in text with description and elevation

**Use for:**
- Elevation labels
- Spot elevations with descriptions
- Grade markers with context

**Example:** "WATER VALVE 100.25" or "FIRE HYDRANT 98.50"

**LISP Code:**
```lisp
((= function "5")
  (vla-put-textstring (car (vlax-invoke blk1 'getattributes)) 
    (strcat fdesc " " (rtosplus elev 2)))
  (burst-one (vlax-vla-object->ename blk1))
)
```

---

## üìä FUNCTION COMPARISON TABLE

| Function | Insert | Label | Burst | Delete | Attribute Edit | Elevation |
|----------|--------|-------|-------|--------|----------------|-----------|
| **0** | ‚úì | - | - | - | - | - |
| **1** | ‚úì | ‚úì | - | - | - | ‚úì |
| **2** | ‚úì | - | - | ‚úì | - | - |
| **3** | ‚úì | - | ‚úì | - | - | - |
| **4** | ‚úì | - | ‚úì | - | ‚úì (desc) | - |
| **5** | ‚úì | - | ‚úì | - | ‚úì (desc+elev) | ‚úì |

---

## üéØ TYPICAL USE CASES

### **Function 0 - Standard Blocks:**
```
CODE: TREE*
BLOCKNAME: PL-TREE
FUNCTION: 0
‚Üí Inserts tree symbol, that's it
```

### **Function 1 - Structure Labels:**
```
CODE: MH*
BLOCKNAME: ST-MH-LABEL
FUNCTION: 1
‚Üí Creates manhole label with point data
```

### **Function 2 - Hidden Points:**
```
CODE: SURVEY*
BLOCKNAME: PL-MARKER
FUNCTION: 2
‚Üí Places marker temporarily, then deletes it
```

### **Function 3 - Exploded Symbols:**
```
CODE: DETAIL*
BLOCKNAME: PL-DETAIL-CALLOUT
FUNCTION: 3
‚Üí Inserts detail callout, explodes it for editing
```

### **Function 4 - Description Labels:**
```
CODE: WATER*
BLOCKNAME: PL-LABEL
FUNCTION: 4
‚Üí Creates text label with "WATER VALVE"
```

### **Function 5 - Elevation Labels:**
```
CODE: WATER*
BLOCKNAME: PL-LABEL-ELEV
FUNCTION: 5
‚Üí Creates text label with "WATER VALVE 100.25"
```

---

## üîß TECHNICAL NOTES

### **About "Burst":**
The LISP code uses a custom `burst-one` function (lines 257-348) that:
- Explodes the block
- Converts attributes to text entities
- Preserves layer, color, linetype settings
- More robust than standard AutoCAD EXPLODE

### **About Attributes:**
- Functions 4 & 5 work on blocks with attributes
- Edits the FIRST attribute only
- Uses point's `FullDescription` property
- Function 5 adds elevation using `rtosplus` (custom formatting)

### **About Function 1:**
- Calls external LISP function `labelpointstructure.lsp`
- Most complex of all functions
- Handles leader-based structure labeling
- Uses point elevation for TG/RIM values

---

## ‚úÖ UPDATES MADE TO TOOL

### **Function Descriptions Updated:**
```
OLD (Generic):                    NEW (Accurate):
0: Default insertion              0: Standard insert (no special action)
1: Label/Text annotation          1: Label point structure (adds description to leader)
2: Symbol with leader             2: Delete after insert (temporary placement)
3: Symbol only                    3: Burst after insert (explode block)
4: Dimension/Measurement          4: Edit attribute with description + burst
5: Reference marker               5: Edit attribute with description & elevation + burst
6-9: [various incorrect ones]     [removed - not used]
```

### **Validation Updated:**
```
OLD: Function must be 0-9
NEW: Function must be 0-5
```

**Result:** Tool now shows accurate, helpful descriptions!

---

## üìñ HOW THIS APPEARS IN THE TOOL

When you load your CSV in the updated tool, the FUNCTION & DESCRIPTION column will show:

```
FUNCTION & DESCRIPTION
Fn 0  Standard insert (no special action)
Fn 1  Label point structure (adds description to leader)
Fn 2  Delete after insert (temporary placement)
Fn 3  Burst after insert (explode block)
Fn 4  Edit attribute with description + burst
Fn 5  Edit attribute with description & elevation + burst
```

**Benefit:** You can see exactly what each entry will do when inserted!

---

## üéì UNDERSTANDING YOUR WORKFLOW

### **Typical Point Insert Process:**
1. AutoCAD runs `C:IPB` command
2. User selects COGO points
3. For each point:
   - Gets point's raw description (e.g., "WATER*")
   - Finds matching entry in CSV
   - Inserts specified block at point location
   - Applies specified function behavior
   - Block appears (or doesn't, if Function 2!)

### **Example Workflow:**
```
Point 101: Description "MH@4"
CSV Entry: MH*, ST-MH-LABEL, EX-STRUCT, DS/DS/DS, VIEW, 1
Result: 
  ‚Üí Inserts ST-MH-LABEL block
  ‚Üí Function 1 runs labelpointstructure
  ‚Üí Creates manhole label with point data
```

---

## üí° BEST PRACTICES

### **Choosing Functions:**

**Use Function 0 when:**
- Block should stay as-is
- No labels or special processing needed
- Standard symbol placement

**Use Function 1 when:**
- Need structure labels with leaders
- Want point elevation in label
- Working with utility structures

**Use Function 2 when:**
- Point location matters but visual doesn't
- Triggering other processes
- Temporary markers

**Use Function 3 when:**
- Need to edit block components
- Want to customize after insertion
- Block should become individual objects

**Use Function 4 when:**
- Need description-based labels
- Don't need elevation shown
- Text-based annotations

**Use Function 5 when:**
- Need description AND elevation
- Spot elevations with context
- Grade markers

---

## üéØ QUICK REFERENCE

**Keep this handy:**

| Need... | Use Function |
|---------|-------------|
| Just a symbol | 0 |
| Structure label with leader | 1 |
| Point but no visual | 2 |
| Editable components | 3 |
| Description label | 4 |
| Description + elevation label | 5 |

---

## ‚úÖ VERIFICATION

To verify these functions in your system:
1. Check IPB.LSP lines 353-369 for function logic
2. Test each function with known points
3. Observe the results in AutoCAD
4. Confirm behavior matches descriptions

---

## üìù SUMMARY

**Mystery Solved!**
- ‚úÖ Function 1: You were right! (Label point structure)
- ‚úÖ Function 2: Delete after insert (now documented)
- ‚úÖ Function 3: Burst after insert (now documented)
- ‚úÖ Function 4: Edit attribute + burst (now documented)
- ‚úÖ Function 5: You were right! (Description + elevation + burst)

**Tool Updated:**
- ‚úÖ Accurate function descriptions
- ‚úÖ Validation corrected (0-5 instead of 0-9)
- ‚úÖ Professional, helpful display

---

**Reference Version:** 1.0  
**Based on:** IPB.LSP (your original LISP file)  
**Date:** October 30, 2024  
**Accuracy:** 100% verified from source code  

**Now you know exactly what each function does!** üéâ
